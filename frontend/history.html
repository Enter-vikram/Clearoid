<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>History – Clearoid</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>tailwind.config = { darkMode: 'class' }</script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		body {
			font-family: 'Inter', -apple-system, sans-serif;
		}
	</style>
</head>

<body class="bg-gray-50 dark:bg-black min-h-screen text-gray-900 dark:text-gray-100">
	<div class="max-w-7xl mx-auto p-6">
		<!-- Header -->
		<div class="mb-12 text-center">
			<h1 class="text-5xl font-bold">Submission History</h1>
			<p class="mt-4 text-xl text-gray-600 dark:text-gray-400">
				Clean list — duplicates automatically detected & marked
			</p>
		</div>

		<!-- Stats Cards -->
		<div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-10">
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-8 shadow-xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-4xl font-bold text-blue-600" id="total">0</p>
				<p class="text-gray-600 dark:text-gray-400">Total Titles</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-8 shadow-xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-4xl font-bold text-green-600" id="unique">0</p>
				<p class="text-gray-600 dark:text-gray-400">Unique</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-8 shadow-xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-4xl font-bold text-amber-600" id="duplicates">0</p>
				<p class="text-gray-600 dark:text-gray-400">Duplicates</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-8 shadow-xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-4xl font-bold text-purple-600" id="clusters">0</p>
				<p class="text-gray-600 dark:text-gray-400">Clusters</p>
			</div>
		</div>

		<!-- Controls -->
		<div class="bg-white dark:bg-gray-900 rounded-3xl shadow-xl p-8 mb-8 border border-gray-200 dark:border-gray-800">
			<div class="flex flex-col md:flex-row gap-6 items-center justify-between">
				<div class="flex items-center gap-4">
					<span class="font-medium text-lg">Show:</span>
					<button id="showAll"
						class="px-6 py-3 rounded-2xl font-medium bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">All
						Titles</button>
					<button id="showUnique"
						class="px-6 py-3 rounded-2xl font-medium bg-blue-600 text-white hover:bg-blue-700 transition">Only
						Unique</button>
				</div>
				<input id="search" placeholder="Search titles..."
					class="px-6 py-4 rounded-2xl border-2 border-gray-300 dark:border-gray-700 bg-transparent focus:border-blue-500 focus:outline-none text-lg w-full md:w-96">
			</div>
		</div>

		<!-- Table -->
		<div
			class="bg-white dark:bg-gray-900 rounded-3xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-800">
			<table class="w-full">
				<thead class="bg-gray-50 dark:bg-gray-800">
					<tr>
						<th class="px-8 py-6 text-left text-sm font-semibold">ID</th>
						<th class="px-8 py-6 text-left text-sm font-semibold">Title</th>
						<th class="px-8 py-6 text-left text-sm font-semibold">Status</th>
						<th class="px-8 py-6 text-left text-sm font-semibold">Submitted</th>
					</tr>
				</thead>
				<tbody id="tbody" class="divide-y divide-gray-200 dark:divide-gray-800"></tbody>
			</table>
			<div id="loading" class="text-center py-16 text-gray-500 dark:text-gray-400 text-xl hidden">
				Loading titles...
			</div>
			<div id="empty" class="text-center py-20 text-gray-500 dark:text-gray-400 text-2xl hidden">
				No titles found.
			</div>
		</div>
	</div>

	<script>
		const tbody = document.getElementById("tbody");
		const loading = document.getElementById("loading");
		const empty = document.getElementById("empty");
		const searchInput = document.getElementById("search");
		const showAllBtn = document.getElementById("showAll");
		const showUniqueBtn = document.getElementById("showUnique");
		let allTitles = [];
		let showOnlyUnique = false;

		async function loadTitles() {
				loading.classList.remove("hidden");
				tbody.innerHTML = "";
				try {
					const res = await fetch("/?limit=1000");  // ← THIS LINE FIXED
					const data = await res.json();
					allTitles = data.data || [];
					render();
					updateStats();
				} catch (e) {
					empty.textContent = "Error loading data";
					empty.classList.remove("hidden");
				}
				loading.classList.add("hidden");
			}

		function render() {
			tbody.innerHTML = "";
			const filtered = allTitles
				.filter(t => !showOnlyUnique || t.is_duplicate === 0)
				.filter(t => !searchInput.value || t.title.toLowerCase().includes(searchInput.value.toLowerCase()));

			if (filtered.length === 0) {
				empty.classList.remove("hidden");
				return;
			}
			empty.classList.add("hidden");

			filtered.forEach(t => {
				const tr = document.createElement("tr");
				tr.className = "hover:bg-gray-50 dark:hover:bg-gray-800 transition";
				tr.innerHTML = `
          <td class="px-8 py-6 font-medium">#${t.id}</td>
          <td class="px-8 py-6 max-w-2xl">${t.title}</td>
          <td class="px-8 py-6">
            <span class="${t.is_duplicate ? 'bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400' : 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'} px-4 py-2 rounded-full text-sm font-medium">
              ${t.is_duplicate ? 'Duplicate' : 'Unique'}
            </span>
          </td>
          <td class="px-8 py-6 text-gray-500">${new Date(t.created_at).toLocaleDateString()}</td>
        `;
				tbody.appendChild(tr);
			});
		}

		function updateStats() {
			const total = allTitles.length;
			const unique = allTitles.filter(t => t.is_duplicate === 0).length;
			const duplicates = total - unique;
			document.getElementById("total").textContent = total;
			document.getElementById("unique").textContent = unique;
			document.getElementById("duplicates").textContent = duplicates;
			document.getElementById("clusters").textContent = new Set(allTitles.filter(t => t.is_duplicate).map(t => t.normalized_title)).size;
		}

		showAllBtn.onclick = () => { showOnlyUnique = false; showAllBtn.classList.add("bg-blue-600", "text-white"); showUniqueBtn.classList.remove("bg-blue-600", "text-white"); render(); };
		showUniqueBtn.onclick = () => { showOnlyUnique = true; showUniqueBtn.classList.add("bg-blue-600", "text-white"); showAllBtn.classList.remove("bg-blue-600", "text-white"); render(); };
		searchInput.oninput = () => setTimeout(render, 300);

		loadTitles();
		setInterval(loadTitles, 10000); // Auto-refresh every 10s
	</script>
</body>

</html>