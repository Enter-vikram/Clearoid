===== BACKEND =====
from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import JSONResponse, RedirectResponse
from dotenv import load_dotenv
import os
import logging

# -------------------------------------------------
# ENV
# -------------------------------------------------
load_dotenv()

API_KEY = os.getenv("API_KEY")
DATABASE_URL = os.getenv("DATABASE_URL")

# -------------------------------------------------
# LOGGER
# -------------------------------------------------
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s | %(levelname)s | %(name)s | %(message)s",
)
logger = logging.getLogger("clearoid")

# -------------------------------------------------
# DB SETUP
# -------------------------------------------------
from database.database import Base, engine

# IMPORTANT: import ALL models before create_all
import models.title
import models.bulk_upload_run

Base.metadata.create_all(bind=engine)

# -------------------------------------------------
# ROUTERS
# -------------------------------------------------
from routes.title_routes import router as title_router
from routes.excel_routes import router as excel_router
from routes.admin_routes import router as admin_router

# -------------------------------------------------
# FASTAPI APP
# -------------------------------------------------
app = FastAPI(
    title="Clearoid",
    description="AI-Assisted Title Normalization & Duplicate Detection System",
    version="1.0.0",
)

# -------------------------------------------------
# CORS
# -------------------------------------------------
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# -------------------------------------------------
# GLOBAL ERROR HANDLER
# -------------------------------------------------
@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    logger.exception("Unhandled exception")
    return JSONResponse(
        status_code=500,
        content={"success": False, "detail": "Internal server error"},
    )

# -------------------------------------------------
# ðŸ”§ LEGACY ROUTE SAFETY (FIXES 405 ERRORS)
# -------------------------------------------------
# These catch OLD calls like /submit and /check-duplicate
# and forward them to the real /api/* endpoints

@app.post("/submit")
async def legacy_submit_redirect():
    return RedirectResponse(url="/api/submit", status_code=307)

@app.post("/check-duplicate")
async def legacy_check_duplicate_redirect():
    return RedirectResponse(url="/api/check-duplicate", status_code=307)

# -------------------------------------------------
# ROUTER REGISTRATION (CRITICAL)
# -------------------------------------------------
# title_routes already has prefix="/api"
# excel_routes already has prefix="/excel"

app.include_router(title_router)
app.include_router(excel_router)
app.include_router(admin_router, prefix="/admin", tags=["Admin"])

# -------------------------------------------------
# FRONTEND
# -------------------------------------------------
app.mount(
    "/",
    StaticFiles(directory="frontend", html=True),
    name="frontend",
)
# jobs.py
from redis import Redis
from rq import Queue
import os
import pandas as pd
from services.title_service import process_bulk_titles
from database.database import get_db
from sqlalchemy.orm import Session

redis_conn = Redis(host='localhost', port=6379, db=0)
q = Queue(connection=redis_conn)

def process_file_bulk(temp_path: str):
    db: Session = next(get_db())
    try:
        df = pd.read_excel(temp_path)
        result = process_bulk_titles(db, df)
        print(f"Bulk processing complete: {result}")
        # Optional: delete temp file
        os.remove(temp_path)
        return result
    except Exception as e:
        print(f"Error in bulk processing: {e}")
        return {"error": str(e)}
    finally:
        db.close()# worker.py
from rq import Worker, Queue
from redis import Redis

redis_conn = Redis(host='localhost', port=6379, db=0)

if __name__ == '__main__':
    queues = [Queue('default', connection=redis_conn)]
    worker = Worker(queues, connection=redis_conn)
    worker.work()
(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== routes\admin_routes.py =====  
 type routes\admin_routes.py 
) 
===== routes\admin_routes.py =====
# routes/admin_routes.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from sqlalchemy import func

from database.database import get_db
from models.title import Title

router = APIRouter()


@router.get("/stats")
def stats(db: Session = Depends(get_db)):
    total = db.query(func.count(Title.id)).scalar()

    dup_count = (
        db.query(func.count(Title.id))
        .filter(Title.is_duplicate == 1)
        .scalar()
    )

    unique = total - dup_count

    avg_len = db.query(func.avg(func.length(Title.title))).scalar() or 0

    top_norm = (
        db.query(
            Title.normalized_title,
            func.count(Title.id).label("cnt")
        )
        .group_by(Title.normalized_title)
        .order_by(func.count(Title.id).desc())
        .limit(10)
        .all()
    )

    recent = (
        db.query(Title)
        .order_by(Title.created_at.desc())
        .limit(10)
        .all()
    )

    return {
        "total": total,
        "duplicates": dup_count,
        "unique": unique,
        "avg_title_length": float(avg_len),
        "top_normalized": [
            {"normalized": n, "count": c}
            for n, c in top_norm
        ],
        "recent": [
            {
                "id": r.id,
                "title": r.title,
                "created_at": r.created_at.isoformat(),
            }
            for r in recent
        ],
    }

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== routes\bulk_upload_routes.py =====  
 type routes\bulk_upload_routes.py 
) 
===== routes\bulk_upload_routes.py =====
from fastapi import APIRouter
from database.database import SessionLocal
from models.bulk_upload_run import BulkUploadRun

router = APIRouter(prefix="/bulk-uploads", tags=["Bulk Uploads"])


@router.get("")
def list_bulk_uploads():
    """
    Returns history of all bulk upload runs
    (latest first).
    """
    db = SessionLocal()
    try:
        return (
            db.query(BulkUploadRun)
            .order_by(BulkUploadRun.created_at.desc())
            .all()
        )
    finally:
        db.close()


@router.get("/{run_id}")
def get_bulk_upload(run_id: int):
    """
    Get a single bulk upload run by ID.
    Useful for audit/debug.
    """
    db = SessionLocal()
    try:
        run = (
            db.query(BulkUploadRun)
            .filter(BulkUploadRun.id == run_id)
            .first()
        )

        if not run:
            return {"error": "Bulk upload run not found"}

        return run
    finally:
        db.close()

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== routes\excel_routes.py =====  
 type routes\excel_routes.py 
) 
===== routes\excel_routes.py =====
from fastapi import APIRouter, UploadFile, File, HTTPException, BackgroundTasks
import os
import pandas as pd
import numpy as np
import hashlib

from database.database import SessionLocal
from models.title import Title
from models.bulk_upload_run import BulkUploadRun
from services.excel_deduper import dedupe_excel
from services.embedding_service import get_embedding

router = APIRouter(prefix="/excel", tags=["Excel"])

TEMP_DIR = "./temp"


def hash_file(path: str) -> str:
    h = hashlib.sha256()
    with open(path, "rb") as f:
        for chunk in iter(lambda: f.read(8192), b""):
            h.update(chunk)
    return h.hexdigest()


def process_file_bulk_bg(file_path: str, filename: str):
    db = SessionLocal()
    try:
        file_hash = hash_file(file_path)

        existing_run = (
            db.query(BulkUploadRun)
            .filter(BulkUploadRun.file_hash == file_hash)
            .first()
        )

        if existing_run:
            print("Duplicate file upload skipped:", filename)
            return

        df = pd.read_excel(file_path)

        unique_df, clusters = dedupe_excel(
            df,
            column="title",
            ignore_numbers=True
        )

        existing_norms = {
            r[0] for r in db.query(Title.normalized_title).all()
        }

        saved = 0

        for _, row in unique_df.iterrows():
            normalized = row["normalized"]

            if normalized in existing_norms:
                continue

            vec = get_embedding(normalized)
            vec_bytes = np.array(vec, dtype=np.float32).tobytes()

            db.add(
                Title(
                    title=row["title"],
                    normalized_title=normalized,
                    embedding=vec_bytes,
                    is_duplicate=0
                )
            )

            existing_norms.add(normalized)
            saved += 1

        run = BulkUploadRun(
            filename=filename,
            file_hash=file_hash,
            processed=len(df),
            saved=saved,
            duplicates=len(df) - saved,
        )

        db.add(run)
        db.commit()

        print({
            "file": filename,
            "processed": len(df),
            "saved": saved,
            "duplicates": len(df) - saved,
            "clusters": {k: v for k, v in clusters.items() if len(v) > 1}
        })

    finally:
        db.close()


@router.post("/bulk-upload")
async def bulk_upload(
    file: UploadFile = File(...),
    background_tasks: BackgroundTasks = BackgroundTasks(),
):
    if not file.filename.lower().endswith((".xlsx", ".xls")):
        raise HTTPException(
            status_code=400,
            detail="Only Excel files (.xlsx, .xls) are allowed"
        )

    os.makedirs(TEMP_DIR, exist_ok=True)
    temp_path = os.path.join(TEMP_DIR, file.filename)

    with open(temp_path, "wb") as f:
        f.write(await file.read())

    background_tasks.add_task(
        process_file_bulk_bg,
        temp_path,
        file.filename
    )

    return {
        "status": "processing",
        "filename": file.filename
    }

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== routes\title_routes.py =====  
 type routes\title_routes.py 
) 
===== routes\title_routes.py =====
from fastapi import APIRouter, Depends, Query
from sqlalchemy.orm import Session
from sqlalchemy import func

from database.database import get_db
from schemas.title_schema import TitleCreate, TitleOut
from services.title_service import (
    save_title,
    check_duplicate,
    find_similar_titles,
    count_duplicates,
)
from models.title import Title

router = APIRouter(prefix="/api", tags=["Titles"])


@router.post("/submit", response_model=TitleOut)
def submit(item: TitleCreate, db: Session = Depends(get_db)):
    return save_title(db, item)


@router.post("/check-duplicate")
def check_duplicate_route(item: TitleCreate, db: Session = Depends(get_db)):
    return check_duplicate(db, item)


@router.post("/similar-titles")
def similar_titles(item: TitleCreate, db: Session = Depends(get_db)):
    return {"results": find_similar_titles(db, item)}


@router.get("/duplicate-count")
def duplicate_count(db: Session = Depends(get_db)):
    return {"duplicate_count": count_duplicates(db)}


@router.get("/clusters")
def clusters(db: Session = Depends(get_db)):
    groups = (
        db.query(
            Title.normalized_title.label("group"),
            func.count(Title.id).label("count")
        )
        .group_by(Title.normalized_title)
        .having(func.count(Title.id) > 1)
        .all()
    )

    return [
        {"group": g.group, "count": g.count}
        for g in groups
    ]


@router.get("/history")
def history(db: Session = Depends(get_db)):
    rows = (
        db.query(Title)
        .order_by(Title.created_at.desc())
        .all()
    )

    data = []
    for r in rows:
        data.append({
            "id": r.id,
            "title": r.title,
            "normalized": r.normalized_title,
            "status": "duplicate" if r.is_duplicate else "unique",
            "cluster": r.normalized_title,
            "created_at": r.created_at.isoformat()
        })

    return {
        "total": len(data),
        "unique": sum(1 for d in data if d["status"] == "unique"),
        "duplicates": sum(1 for d in data if d["status"] == "duplicate"),
        "clusters": len(set(d["cluster"] for d in data)),
        "data": data
    }


@router.get("/titles")
def get_titles(
    page: int = Query(1, ge=1),
    limit: int = Query(20, ge=1),
    search: str | None = None,
    duplicates: bool | None = None,
    db: Session = Depends(get_db),
):
    query = db.query(Title)

    if search:
        query = query.filter(
            (Title.title.ilike(f"%{search}%")) |
            (Title.normalized_title.ilike(f"%{search}%"))
        )

    if duplicates is not None:
        query = query.filter(Title.is_duplicate == (1 if duplicates else 0))

    total = query.count()
    rows = query.offset((page - 1) * limit).limit(limit).all()

    return {
        "total": total,
        "data": [
            {
                "id": r.id,
                "title": r.title,
                "normalized": r.normalized_title,
                "is_duplicate": r.is_duplicate,
                "created_at": r.created_at.isoformat(),
            }
            for r in rows
        ],
    }

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\embedding_service.py =====  
 type services\embedding_service.py 
) 
===== services\embedding_service.py =====
from pathlib import Path
from dotenv import load_dotenv

# Always load .env (safe even if empty)
BASE_DIR = Path(__file__).resolve().parents[1]
load_dotenv(BASE_DIR / ".env")

import os
import logging
from typing import List

import numpy as np
from sentence_transformers import SentenceTransformer

logger = logging.getLogger(__name__)

# ==========================================================
# Configuration
# ==========================================================

USE_OPENAI = os.getenv("USE_OPENAI", "false").lower() == "true"
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# ==========================================================
# MiniLM (default, CPU-only, deterministic)
# ==========================================================

_minilm_model = None

def get_minilm_model():
    global _minilm_model

    if _minilm_model is None:
        _minilm_model = SentenceTransformer(
            "all-MiniLM-L6-v2",
            device="cpu"
        )

    return _minilm_model


def get_minilm_embedding(text: str) -> List[float]:
    model = get_minilm_model()

    # â— IMPORTANT: no normalize_embeddings here
    emb = model.encode(
        text,
        convert_to_numpy=True,
        show_progress_bar=False
    )

    return emb.tolist()

# ==========================================================
# OpenAI (optional, guarded)
# ==========================================================

_openai_client = None

def get_openai_client():
    global _openai_client

    if not OPENAI_API_KEY:
        raise RuntimeError("OPENAI_API_KEY not set")

    if _openai_client is None:
        from openai import OpenAI
        _openai_client = OpenAI(api_key=OPENAI_API_KEY)

    return _openai_client


def get_openai_embedding(text: str) -> List[float]:
    client = get_openai_client()

    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )

    return response.data[0].embedding

# ==========================================================
# Unified public API
# ==========================================================

def get_embedding(text: str) -> List[float]:
    """
    Returns an embedding for the given text.

    Default: MiniLM
    Optional: OpenAI (only if USE_OPENAI=true)
    """

    if USE_OPENAI:
        try:
            return get_openai_embedding(text)
        except Exception as e:
            logger.warning(
                "OpenAI embedding failed, falling back to MiniLM: %s",
                str(e)
            )

    return get_minilm_embedding(text)

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\excel_deduper.py =====  
 type services\excel_deduper.py 
) 
===== services\excel_deduper.py =====
# services/excel_deduper.py

import pandas as pd
import re
from utils.text_cleaner import clean_text


def _remove_numbers(text: str) -> str:
    """
    Removes standalone numbers from text.
    Example:
      'sample title number 123' -> 'sample title number'
    """
    return re.sub(r"\b\d+\b", "", text).strip()


def dedupe_excel(
    df: pd.DataFrame,
    column: str = "title",
    ignore_numbers: bool = True,
):
    """
    Deterministic Excel deduper.

    Parameters:
    - df: input DataFrame
    - column: column containing titles
    - ignore_numbers:
        True  -> 'Title 1', 'Title 2' are duplicates
        False -> treated as unique

    Returns:
    - unique_df: DataFrame with only unique rows
    - clusters: dict[str, list[str]]
        {
          normalized_title: [original titles...]
        }
    """

    if column not in df.columns:
        raise ValueError(f"Excel must contain a '{column}' column")

    df = df.copy()
    df[column] = df[column].astype(str)

    # -------------------------------------------------
    # Step 1: normalize text (lowercase, punctuation)
    # -------------------------------------------------
    df["normalized"] = df[column].apply(clean_text)

    # -------------------------------------------------
    # Step 2: optionally strip numbers
    # -------------------------------------------------
    if ignore_numbers:
        df["normalized"] = df["normalized"].apply(_remove_numbers)

    # Final cleanup (collapse spaces after number removal)
    df["normalized"] = df["normalized"].str.replace(r"\s+", " ", regex=True).str.strip()

    # -------------------------------------------------
    # Step 3: build clusters (DO NOT DELETE INFO)
    # -------------------------------------------------
    clusters = (
        df.groupby("normalized")[column]
        .apply(list)
        .to_dict()
    )

    # -------------------------------------------------
    # Step 4: deterministic dedupe
    # Keep FIRST occurrence only (order-preserving)
    # -------------------------------------------------
    unique_df = df.drop_duplicates(subset="normalized", keep="first")

    return unique_df, clusters

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\excel_service.py =====  
 type services\excel_service.py 
) 
===== services\excel_service.py =====
import pandas as pd
from io import BytesIO
from sqlalchemy.orm import Session

from services.title_service import process_bulk_titles


def process_excel(file_bytes: bytes, db: Session):
    df = pd.read_excel(BytesIO(file_bytes))

    if "title" not in df.columns:
        raise ValueError("Excel must contain a column named 'title'")

    titles = (
        df["title"]
        .dropna()
        .astype(str)
        .tolist()
    )

    return process_bulk_titles(titles, db)

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\file_hash.py =====  
 type services\file_hash.py 
) 
===== services\file_hash.py =====
import hashlib

def hash_file(path: str) -> str:
    h = hashlib.sha256()
    with open(path, "rb") as f:
        for chunk in iter(lambda: f.read(8192), b""):
            h.update(chunk)
    return h.hexdigest()

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\ml_service.py =====  
 type services\ml_service.py 
) 
===== services\ml_service.py =====
# services/ml_service.py

import re
import numpy as np
from sklearn.metrics.pairwise import cosine_similarity

from services.embedding_service import get_embedding


# --------------------------
# Text normalization
# --------------------------
def normalize(text: str) -> str:
    text = text.lower()
    text = re.sub(r"[^\w\s]", " ", text)
    text = re.sub(r"\s+", " ", text)
    return text.strip()


# --------------------------
# Duplicate detection
# --------------------------
def find_duplicates(new_title: str, threshold: float = 0.80):
    """
    Finds the most similar existing title.
    Returns (duplicate_info | None, max_score)
    """
    from database.database import get_db_session
    from models.title import Title

    clean_title = normalize(new_title)
    new_embedding = np.array(get_embedding(clean_title), dtype=np.float32)

    with get_db_session() as session:
        titles = session.query(Title).all()

        if not titles:
            return None, 0.0

        embeddings = []
        valid_titles = []

        for t in titles:
            if t.embedding:
                emb = np.frombuffer(t.embedding, dtype=np.float32)
                embeddings.append(emb)
                valid_titles.append(t)

        if not embeddings:
            return None, 0.0

        embeddings = np.vstack(embeddings)

        similarities = cosine_similarity([new_embedding], embeddings)[0]

        max_idx = int(np.argmax(similarities))
        max_score = float(similarities[max_idx])

        if max_score >= threshold:
            duplicate = valid_titles[max_idx]
            return {
                "id": duplicate.id,
                "title": duplicate.title,
                "score": round(max_score, 3),
            }, max_score

        return None, max_score

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== services\title_service.py =====  
 type services\title_service.py 
) 
===== services\title_service.py =====
from sqlalchemy.orm import Session
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np
import pandas as pd

from utils.text_cleaner import clean_text
from services.embedding_service import get_embedding
from models.title import Title

SIMILARITY_THRESHOLD = 0.85


# ---------------------------------------------------------
# Internal helper: find best semantic match
# ---------------------------------------------------------
def _find_best_match(db: Session, vec: np.ndarray):
    best_score = 0.0
    best_row = None

    rows = db.query(Title).all()

    for row in rows:
        if not row.embedding:
            continue

        try:
            stored = np.frombuffer(row.embedding, dtype=np.float32)
            score = float(cosine_similarity([vec], [stored])[0][0])
        except Exception:
            continue

        if score > best_score:
            best_score = score
            best_row = row

    return best_row, best_score


# ---------------------------------------------------------
# ðŸ”’ HARD RULE: exactly ONE unique per normalized_title
# ---------------------------------------------------------
def enforce_single_primary(db: Session, normalized_title: str):
    """
    Ensures exactly ONE unique row per cluster.
    Oldest row (by created_at) is canonical primary.
    All others are forced to duplicate.
    """
    rows = (
        db.query(Title)
        .filter(Title.normalized_title == normalized_title)
        .order_by(Title.created_at.asc())
        .all()
    )

    if not rows:
        return

    primary = rows[0]
    primary.is_duplicate = 0

    for r in rows[1:]:
        r.is_duplicate = 1

    db.commit()


# ---------------------------------------------------------
# Save a single title (OPTION A + CLUSTER LOCK)
# ---------------------------------------------------------
def save_title(db: Session, item):
    raw = item.title
    cleaned = clean_text(raw)

    vec = np.array(get_embedding(cleaned), dtype=np.float32)
    vec_bytes = vec.tobytes()

    best_row, best_score = _find_best_match(db, vec)

    if best_row and best_score >= SIMILARITY_THRESHOLD:
        # semantic duplicate â†’ inherit canonical cluster
        normalized = best_row.normalized_title
        is_duplicate = 1
    else:
        # new semantic cluster
        normalized = cleaned
        is_duplicate = 0

    obj = Title(
        title=raw,
        normalized_title=normalized,
        embedding=vec_bytes,
        is_duplicate=is_duplicate,
    )

    db.add(obj)
    db.commit()
    db.refresh(obj)

    # ðŸ”’ enforce canonical truth AFTER insert
    enforce_single_primary(db, normalized)

    return obj


# ---------------------------------------------------------
# Check duplicate (READ ONLY)
# ---------------------------------------------------------
def check_duplicate(db: Session, item, threshold: float = SIMILARITY_THRESHOLD):
    raw = item.title
    cleaned = clean_text(raw)

    vec = np.array(get_embedding(cleaned), dtype=np.float32)
    best_row, best_score = _find_best_match(db, vec)

    return {
        "duplicate": bool(best_row and best_score >= threshold),
        "score": round(best_score, 3),
        "match_id": best_row.id if best_row else None,
        "canonical": best_row.normalized_title if best_row else None,
    }


# ---------------------------------------------------------
# Find similar titles (unchanged semantics)
# ---------------------------------------------------------
def find_similar_titles(db: Session, item, threshold: float = 0.75):
    raw = item.title
    cleaned = clean_text(raw)

    vec = np.array(get_embedding(cleaned), dtype=np.float32)
    results = []

    for row in db.query(Title).all():
        try:
            stored = np.frombuffer(row.embedding, dtype=np.float32)
            score = float(cosine_similarity([vec], [stored])[0][0])
        except Exception:
            continue

        if score >= threshold:
            results.append({
                "id": row.id,
                "title": row.title,
                "score": round(score, 3),
            })

    return sorted(results, key=lambda x: x["score"], reverse=True)


# ---------------------------------------------------------
# Bulk upload (EXACT SAME RULES + LOCK)
# ---------------------------------------------------------
def process_bulk_titles(db: Session, df: pd.DataFrame):
    summary = {
        "processed": 0,
        "duplicates": 0,
        "saved": 0,
    }

    titles = df["title"].dropna().astype(str).tolist()

    for raw in titles:
        summary["processed"] += 1
        cleaned = clean_text(raw)

        vec = np.array(get_embedding(cleaned), dtype=np.float32)
        best_row, best_score = _find_best_match(db, vec)

        if best_row and best_score >= SIMILARITY_THRESHOLD:
            normalized = best_row.normalized_title
            is_duplicate = 1
            summary["duplicates"] += 1
        else:
            normalized = cleaned
            is_duplicate = 0
            summary["saved"] += 1

        obj = Title(
            title=raw,
            normalized_title=normalized,
            embedding=vec.tobytes(),
            is_duplicate=is_duplicate,
        )

        db.add(obj)
        db.commit()

        # ðŸ”’ enforce after EVERY insert
        enforce_single_primary(db, normalized)

    return summary


# ---------------------------------------------------------
# Count duplicates
# ---------------------------------------------------------
def count_duplicates(db: Session):
    return (
        db.query(Title)
        .filter(Title.is_duplicate == 1)
        .count()
    )

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== database\database.py =====  
 type database\database.py 
) 
===== database\database.py =====
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, declarative_base

DATABASE_URL = "sqlite:///./titles.db"

engine = create_engine(
    DATABASE_URL,
    connect_args={"check_same_thread": False}
)

SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

Base = declarative_base()

# ðŸ”½ IMPORTANT: force model registration
# Without these imports, tables will NEVER be created
from models.title import Title
from models.bulk_upload_run import BulkUploadRun 


def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== database\__init__.py =====  
 type database\__init__.py 
) 
===== database\__init__.py =====
 

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== models\bulk_upload_run.py =====  
 type models\bulk_upload_run.py 
) 
===== models\bulk_upload_run.py =====
from sqlalchemy import Column, Integer, String, DateTime
from database.database import Base
from datetime import datetime


class BulkUploadRun(Base):
    __tablename__ = "bulk_upload_runs"

    id = Column(Integer, primary_key=True)
    filename = Column(String, nullable=False)
    file_hash = Column(String, unique=True, nullable=False)

    processed = Column(Integer, default=0)
    saved = Column(Integer, default=0)
    duplicates = Column(Integer, default=0)

    created_at = Column(DateTime, default=datetime.utcnow)

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== models\title.py =====  
 type models\title.py 
) 
===== models\title.py =====
# models/title.py
from sqlalchemy import Column, Integer, String, Text, DateTime
from datetime import datetime
from database.database import Base

class Title(Base):
    __tablename__ = "titles"

    # Primary key
    id = Column(Integer, primary_key=True, index=True)

    # Original user-entered title
    title = Column(String, nullable=False)

    # Normalized title used for fuzzy search & filtering
    normalized_title = Column(String, nullable=False, index=True)

    # Embedding stored as JSON string (vector output)
    embedding = Column(Text, nullable=False)

    # Duplicate flag (0 = unique, 1 = duplicate)
    is_duplicate = Column(Integer, default=0, index=True)

    # Timestamp for sorting by newest/oldest
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== models\__init__.py =====  
 type models\__init__.py 
) 
===== models\__init__.py =====
from .title import Title
from .bulk_upload_run import BulkUploadRun 

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== schemas\title_schema.py =====  
 type schemas\title_schema.py 
) 
===== schemas\title_schema.py =====
# schemas/title_schema.py
from pydantic import BaseModel
from typing import Optional
from datetime import datetime

class TitleCreate(BaseModel):
    title: str

    model_config = {
        "from_attributes": True
    }

class TitleUpdate(BaseModel):
    title: Optional[str] = None
    normalized_title: Optional[str] = None
    is_duplicate: Optional[int] = None

    model_config = {
        "from_attributes": True
    }

class TitleOut(BaseModel):
    id: int
    title: str
    normalized_title: str
    is_duplicate: int
    created_at: datetime

    model_config = {
        "from_attributes": True
    }

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== utils\file_hash.py =====  
 type utils\file_hash.py 
) 
===== utils\file_hash.py =====
import hashlib

def hash_file(path: str) -> str:
    h = hashlib.sha256()

    with open(path, "rb") as f:
        for chunk in iter(lambda: f.read(8192), b""):
            h.update(chunk)

    return h.hexdigest()

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== utils\text_cleaner.py =====  
 type utils\text_cleaner.py 
) 
===== utils\text_cleaner.py =====
import re
import os

IGNORE_NUMBERS = os.getenv("IGNORE_NUMBERS", "true").lower() == "true"

def clean_text(text: str) -> str:
    text = text.lower()

    if IGNORE_NUMBERS:
        text = re.sub(r"\d+", "", text)

    text = re.sub(r"[^\w\s]", " ", text)
    text = re.sub(r"\s+", " ", text)

    return text.strip()
===== FRONTEND =====

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\admin.html =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\admin.html 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\admin.html =====
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Admin Stats â€“ Clearoid</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>tailwind.config = { darkMode: 'class' }</script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		body {
			font-family: 'Inter', -apple-system, sans-serif;
		}
	</style>
</head>

<body class="bg-gray-50 dark:bg-black min-h-screen text-gray-900 dark:text-gray-100">
	<div class="max-w-6xl mx-auto p-8">
		<div class="text-center mb-16">
			<h1 class="text-5xl font-bold">Admin Dashboard</h1>
			<p class="mt-4 text-xl text-gray-600 dark:text-gray-400">Real-time system analytics</p>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-blue-600" id="total">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-3">Total Submissions</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-green-600" id="unique">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-3">Unique Titles</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-amber-600" id="duplicates">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-3">Duplicates Removed</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-purple-600" id="avgLen">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-3">Avg Title Length</p>
			</div>
		</div>

		<div class="mt-16 grid grid-cols-1 lg:grid-cols-2 gap-8">
			<div class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800">
				<h2 class="text-3xl font-bold mb-6">Top Repeated Topics</h2>
				<div id="topTopics" class="space-y-4"></div>
			</div>
			<div class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800">
				<h2 class="text-3xl font-bold mb-6">Recent Submissions</h2>
				<div id="recent" class="space-y-4"></div>
			</div>
		</div>

		<div class="text-center mt-16">
			<button id="darkModeToggle"
				class="px-8 py-4 bg-gray-200 dark:bg-gray-700 rounded-2xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition">
				Toggle Dark Mode
			</button>
		</div>
	</div>

	<script>
		async function loadStats() {
			const res = await fetch("/admin/stats");
			const s = await res.json();
			document.getElementById("total").textContent = s.total;
			document.getElementById("unique").textContent = s.unique;
			document.getElementById("duplicates").textContent = s.duplicates;
			document.getElementById("avgLen").textContent = s.avg_title_length.toFixed(0);

			const top = document.getElementById("topTopics");
			top.innerHTML = s.top_normalized.map(t => `
        <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700">
          <span class="font-medium">${t.normalized}</span>
          <span class="text-2xl font-bold text-purple-600">${t.count}</span>
        </div>
      `).join("");

			const recent = document.getElementById("recent");
			recent.innerHTML = s.recent.slice(0, 8).map(r => `
        <div class="py-3 border-b border-gray-200 dark:border-gray-700">
          <p class="font-medium truncate">${r.title}</p>
          <p class="text-sm text-gray-500">${new Date(r.created_at).toLocaleString()}</p>
        </div>
      `).join("");
		}

		document.getElementById("darkModeToggle").onclick = () => {
			document.documentElement.classList.toggle("dark");
		};

		loadStats();
		setInterval(loadStats, 10000);
	</script>
</body>

</html>
(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\clusters.html =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\clusters.html 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\clusters.html =====
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Duplicate Clusters â€“ Clearoid</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>tailwind.config = { darkMode: 'class' }</script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://unpkg.com/vis-network@9.1.2/standalone/umd/vis-network.min.js"></script>
	<style>
		body {
			font-family: 'Inter', -apple-system, sans-serif;
		}

		#network {
			height: 80vh;
			border-radius: 2rem;
		}
	</style>
</head>

<body class="bg-gray-50 dark:bg-black min-h-screen text-gray-900 dark:text-gray-100">
	<div class="max-w-7xl mx-auto p-8">
		<!-- Header -->
		<div class="text-center mb-12">
			<h1 class="text-5xl font-bold">Duplicate Clusters</h1>
			<p class="mt-4 text-xl text-gray-600 dark:text-gray-400">
				Visual map of all semantically similar titles
			</p>
		</div>

		<!-- Stats -->
		<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-purple-600" id="clusterCount">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-2">Clusters Found</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-amber-600" id="totalDupes">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-2">Duplicate Titles</p>
			</div>
			<div
				class="bg-white dark:bg-gray-900 rounded-3xl p-10 shadow-2xl border border-gray-200 dark:border-gray-800 text-center">
				<p class="text-6xl font-bold text-blue-600" id="largestCluster">0</p>
				<p class="text-xl text-gray-600 dark:text-gray-400 mt-2">Largest Group</p>
			</div>
		</div>

		<!-- Graph -->
		<div
			class="bg-white dark:bg-gray-900 rounded-3xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-800">
			<div id="network"></div>
		</div>

		<!-- Empty State -->
		<div id="empty" class="text-center py-20 text-3xl text-gray-400 hidden">
			No duplicate clusters yet â€” all titles are unique!
		</div>
	</div>

	<script>
		const container = document.getElementById("network");
		const empty = document.getElementById("empty");

		async function loadClusters() {
			try {
				const res = await fetch("/webhook/clusters");
				const groups = await res.json();

				if (!groups.length) {
					empty.classList.remove("hidden");
					container.style.display = "none";
					return;
				}

				empty.classList.add("hidden");
				container.style.display = "block";

				const nodes = [];
				const edges = [];
				let nodeId = 1;
				let totalDupes = 0;
				let largest = 0;

				const colors = ["#3b82f6", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6", "#ec4899", "#06b6d4"];

				groups.forEach((cluster, i) => {
					const color = colors[i % colors.length];
					const clusterNodes = [];

					cluster.titles.forEach(t => {
						nodes.push({
							id: nodeId,
							label: t.title,
							color: { background: color + '22', border: color, highlight: { background: color + '44', border: color } },
							font: { color: 'gray-800', size: 16 },
							shape: 'dot',
							size: 20 + t.title.length
						});
						clusterNodes.push(nodeId);
						nodeId++;
					});

					totalDupes += cluster.titles.length;
					largest = Math.max(largest, cluster.titles.length);

					// Connect all nodes in cluster
					for (let a = 0; a < clusterNodes.length; a++) {
						for (let b = a + 1; b < clusterNodes.length; b++) {
							edges.push({ from: clusterNodes[a], to: clusterNodes[b], color: color + '44' });
						}
					}
				});

				document.getElementById("clusterCount").textContent = groups.length;
				document.getElementById("totalDupes").textContent = totalDupes;
				document.getElementById("largestCluster").textContent = largest;

				const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
				const options = {
					physics: { stabilization: false, barnesHut: { gravitationalConstant: -8000 } },
					nodes: { shadow: true },
					edges: { smooth: false, width: 2 },
				};
				new vis.Network(container, data, options);
			} catch (e) {
				empty.textContent = "Error loading clusters";
				empty.classList.remove("hidden");
			}
		}
    }

		loadClusters();
		setInterval(loadClusters, 15000); // Refresh every 15s
	</script>
</body>

</html>
(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\history.html =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\history.html 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\history.html =====
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Submission History â€“ Clearoid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: Inter, system-ui, sans-serif; }
    .badge { padding:.25rem .75rem;border-radius:9999px;font-size:.8rem;font-weight:500 }
    .uniq { background:#dcfce7;color:#166534 }
    .dup { background:#fef3c7;color:#92400e }
    .tab { padding:.6rem 1.6rem;border-radius:9999px;font-weight:600;background:#e5e7eb;cursor:pointer }
    .tab.active { background:#2563eb;color:white }
    .review-panel { background:white;border-radius:1.25rem;padding:1.75rem;box-shadow:0 10px 25px rgba(0,0,0,.08) }
  </style>
</head>

<body class="bg-gray-50 min-h-screen p-10 text-gray-900">
<div class="max-w-7xl mx-auto">

  <!-- TABS -->
  <div class="flex justify-center gap-4 mb-10">
    <button id="tabHistory" class="tab active" onclick="showHistory()">Submission History</button>
    <button id="tabReview" class="tab" onclick="showReview()">Submission Review</button>
  </div>

  <!-- HISTORY -->
  <div id="historySection">

    <div class="relative text-center mb-8">
      <div class="absolute right-0 top-0 flex gap-2 items-center">
        <select id="exportFormat"
          class="border rounded-lg px-3 py-2 text-sm">
          <option value="flat">Flat CSV</option>
          <option value="clustered">Clustered CSV</option>
        </select>

        <button onclick="exportCSV()"
          class="px-4 py-2 rounded-lg bg-gray-900 text-white text-sm">
          Export CSV
        </button>
      </div>

      <h1 class="text-5xl font-bold">Submission History</h1>
      <p class="mt-3 text-gray-500">Semantic duplicate review Â· Decision transparency enabled</p>
    </div>

    <!-- STATS -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-2xl shadow text-center">
        <div id="statTotal" class="text-3xl font-bold text-blue-600">0</div>Total
      </div>
      <div class="bg-white p-6 rounded-2xl shadow text-center">
        <div id="statUnique" class="text-3xl font-bold text-green-600">0</div>Unique
      </div>
      <div class="bg-white p-6 rounded-2xl shadow text-center">
        <div id="statDup" class="text-3xl font-bold text-amber-600">0</div>Duplicates
      </div>
      <div class="bg-white p-6 rounded-2xl shadow text-center">
        <div id="statClusters" class="text-3xl font-bold text-purple-600">0</div>Clusters
      </div>
    </div>

    <!-- CONTROLS -->
    <div class="bg-white p-6 rounded-2xl shadow mb-8 space-y-5">
      <div class="flex flex-wrap gap-2 items-center">
        <button onclick="setFilter('all')" class="px-4 py-2 rounded-lg bg-blue-600 text-white">All</button>
        <button onclick="setFilter('unique')" class="px-4 py-2 rounded-lg bg-gray-100">Only Unique</button>
        <button onclick="setFilter('duplicate')" class="px-4 py-2 rounded-lg bg-gray-100">Only Duplicate</button>

        <button id="deleteAllBtn"
          onclick="deleteAllDuplicates()"
          class="px-4 py-2 rounded-lg bg-red-600 text-white hidden">
          Delete all duplicates
        </button>

        <input id="search" oninput="applyUIState()"
          placeholder="Search titlesâ€¦"
          class="border rounded-lg px-4 py-2 ml-auto w-64" />
      </div>
    </div>

    <!-- TABLE -->
    <div class="bg-white rounded-2xl shadow overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-100 text-left">
          <tr>
            <th class="p-4">ID</th>
            <th class="p-4">Title</th>
            <th class="p-4">Status</th>
            <th class="p-4">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- REVIEW -->
  <div id="reviewSection" class="hidden mt-10">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold">Submission Review</h1>
    </div>
    <div id="reviewClusters" class="space-y-6"></div>
  </div>
</div>

<script>
let rawData = [];
let visibleRows = [];
let filter = "all";

/* ---------------- FETCH ---------------- */
fetch("/api/history")
  .then(r => r.json())
  .then(res => {
    rawData = res.data;
    applyUIState();
    renderReview();
  });

/* ---------------- STATE ---------------- */
function applyUIState() {
  const q = search.value.toLowerCase();

  visibleRows = rawData
    .filter(r => filter === "all" || r.status === filter)
    .filter(r => r.title.toLowerCase().includes(q));

  renderTable();
  renderStats();

  deleteAllBtn.classList.toggle(
    "hidden",
    !(filter === "duplicate" && visibleRows.length)
  );
}

/* ---------------- RENDER ---------------- */
function renderTable() {
  tbody.innerHTML = "";
  visibleRows.forEach(r => {
    tbody.innerHTML += `
      <tr class="border-b">
        <td class="p-4">#${r.id}</td>
        <td class="p-4 font-medium">${r.title}</td>
        <td class="p-4">
          <span class="badge ${r.status === "duplicate" ? "dup" : "uniq"}">
            ${r.status}
          </span>
        </td>
        <td class="p-4">
          <button onclick="deleteRow(${r.id})"
            class="text-red-600 text-sm">
            Delete
          </button>
        </td>
      </tr>`;
  });
}

function renderStats() {
  statTotal.textContent = visibleRows.length;
  statUnique.textContent = visibleRows.filter(r => r.status === "unique").length;
  statDup.textContent = visibleRows.filter(r => r.status === "duplicate").length;
  statClusters.textContent = new Set(visibleRows.map(r => r.cluster)).size;
}

/* ---------------- EXPORT ---------------- */
function exportCSV() {
  if (!visibleRows.length) {
    alert("Nothing to export");
    return;
  }

  const format = exportFormat.value;
  let rows = [];

  if (format === "clustered") {
    const clusters = {};
    visibleRows.forEach(r => (clusters[r.cluster] ??= []).push(r));

    rows.push(["Cluster", "ID", "Title", "Status"]);
    Object.entries(clusters).forEach(([cluster, items]) => {
      items.forEach(r => {
        rows.push([cluster, r.id, r.title, r.status]);
      });
    });
  } else {
    rows.push(["ID", "Title", "Status", "Cluster"]);
    visibleRows.forEach(r => {
      rows.push([r.id, r.title, r.status, r.cluster]);
    });
  }

  const csv = rows
    .map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(","))
    .join("\n");

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "submissions.csv";
  a.click();
}

/* ---------------- DELETE ---------------- */
function deleteRow(id) {
  if (!confirm("Delete this title?")) return;
  fetch(`/api/title/${id}`, { method: "DELETE" })
    .then(() => {
      rawData = rawData.filter(r => r.id !== id);
      applyUIState();
      renderReview();
    });
}

function deleteAllDuplicates() {
  if (!confirm("Delete ALL duplicates?")) return;
  fetch("/api/duplicates", { method: "DELETE" })
    .then(() => {
      rawData = rawData.filter(r => r.status !== "duplicate");
      filter = "all";
      applyUIState();
      renderReview();
    });
}

/* ---------------- REVIEW ---------------- */
function renderReview() {
  reviewClusters.innerHTML = "";
  const groups = {};
  rawData.forEach(r => (groups[r.cluster] ??= []).push(r));

  Object.values(groups).forEach(items => {
    const primary = items.find(i => i.status === "unique") || items[0];
    reviewClusters.innerHTML += `
      <div class="review-panel">
        <h2 class="font-semibold mb-2">${primary.title}</h2>
        ${items.map(i => `
          <div class="flex justify-between border rounded-lg p-3 mb-2">
            <span>${i.title}</span>
            <span class="badge ${i.status === "duplicate" ? "dup" : "uniq"}">
              ${i.status === "duplicate" ? "Duplicate" : "Primary"}
            </span>
          </div>`).join("")}
      </div>`;
  });
}

/* ---------------- UI ---------------- */
function setFilter(f) { filter = f; applyUIState(); }
function showHistory() {
  historySection.classList.remove("hidden");
  reviewSection.classList.add("hidden");
  tabHistory.classList.add("active");
  tabReview.classList.remove("active");
}
function showReview() {
  reviewSection.classList.remove("hidden");
  historySection.classList.add("hidden");
  tabReview.classList.add("active");
  tabHistory.classList.remove("active");
}
</script>
</body>
</html>

(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\index.html =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\index.html 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\index.html =====
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Clearoid</title>

	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			darkMode: 'class'
		}
	</script>

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

	<style>
		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
		}

		/* FIXED FLOATING LABEL â€” NO OVERLAP EVER */
		.float-label {
			position: relative;
		}

		.float-label input {
			width: 100%;
			padding: 1.5rem 1.25rem;
			font-size: 1.25rem;
			background: transparent;
			border: 2px solid #d1d5db;
			border-radius: 1rem;
			outline: none;
			transition: border-color 0.2s;
		}

		.float-label input:focus {
			border-color: #3b82f6;
		}

		.float-label label {
			position: absolute;
			left: 1.25rem;
			top: 1.5rem;
			color: #6b7280;
			font-size: 1.125rem;
			pointer-events: none;
			transition: all 0.2s ease;
			background: transparent;
			padding: 0 0.25rem;
		}

		.float-label input:focus~label,
		.float-label input:not(:placeholder-shown)~label {
			top: -0.75rem;
			left: 1rem;
			font-size: 0.875rem;
			color: #3b82f6;
			background: white;
			dark: background: #111;
		}

		.dark .float-label input {
			border-color: #374151;
		}

		.dark .float-label label {
			color: #9ca3af;
		}
	</style>
</head>

<body class="bg-gray-50 dark:bg-black min-h-screen flex items-center justify-center p-6">
	<div class="w-full max-w-2xl">

		<!-- Title -->
		<div class="text-center mb-12">
			<h1 class="text-5xl md:text-6xl font-bold text-gray-900 dark:text-white tracking-tight">Clearoid</h1>
			<p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
				Real-time AI duplicate detection for project titles
			</p>
		</div>

		<!-- Card -->
		<div class="bg-white dark:bg-gray-900 rounded-3xl shadow-2xl p-10 border border-gray-200 dark:border-gray-800">

			<!-- Input with floating label â€” NOW FIXED -->
			<div class="float-label">
				<input type="text" id="titleInput" placeholder=" " />
				<label>Enter project title</label>
			</div>

			<!-- Buttons -->
			<div class="flex gap-4 mt-10">
				<button id="submitBtn" class="flex-1 bg-black dark:bg-white text-white dark:text-black 
                               font-semibold py-5 rounded-2xl hover:opacity-90 transition shadow-lg">
					Submit Title
				</button>

				<button id="checkBtn" class="flex-1 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 
                               font-semibold py-5 rounded-2xl hover:bg-gray-200 
                               dark:hover:bg-gray-700 transition shadow-lg">
					Check Duplicate
				</button>
			</div>

			<!-- OR Divider -->
			<div class="text-center text-gray-500 dark:text-gray-400 my-10 text-lg">or</div>

			<!-- Upload Excel -->
			<a href="upload.html">
				<button class="w-full bg-white text-black border hover:bg-gray-100 
                               font-bold py-6 rounded-3xl text-xl shadow-xl 
                               transform hover:scale-105 transition duration-300">
					Upload Excel File (Bulk)
				</button>
			</a>

			<!-- Response -->
			<div id="response" class="message hidden mt-8 text-center py-5 rounded-2xl text-lg font-medium">
			</div>

			<!-- Link -->
			<div class="text-center mt-10">
				<a href="history.html" class="text-blue-600 dark:text-blue-400 hover:underline font-medium text-lg">
					View all submissions â†’
				</a>
			</div>
		</div>
	</div>

	<script>
		const API_URL = "http://127.0.0.1:8000";
		const responseDiv = document.getElementById("response");

		function showMessage(msg, type) {
			responseDiv.textContent = msg;
			responseDiv.className = `message block font-medium text-lg py-5 px-8 rounded-2xl ${type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' :
				type === 'duplicate' ? 'bg-amber-50 text-amber-800 border border-amber-200' :
					'bg-red-50 text-red-800 border border-red-200'
				}`;
		}

		document.getElementById("submitBtn").onclick = async () => {
			const title = document.getElementById("titleInput").value.trim();
			if (!title) return showMessage("Please enter a title", "error");
			try {
				const res = await fetch(`${API_URL}/submit`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ title }) });
				const data = await res.json();
				res.ok ? showMessage(`Saved â€“ ID: ${data.id}`, "success") : showMessage(data.detail || "Server error â€“ try again", "error");
			} catch (e) {
				showMessage("Network error â€“ check connection", "error");
			}
		};

		document.getElementById("checkBtn").onclick = async () => {
			const title = document.getElementById("titleInput").value.trim();
			if (!title) return showMessage("Please enter a title", "error");
			try {
				const res = await fetch(`${API_URL}/check-duplicate`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ title }) });
				const data = await res.json();
				data.duplicate ? showMessage(`Duplicate found â€“ ID: ${data.id}`, "duplicate") : showMessage("Unique title", "success");
			} catch (e) {
				showMessage("Network error â€“ check connection", "error");
			}
		};
	</script>
</body>

</html>
(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\upload.html =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\upload.html 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\upload.html =====
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Upload Excel â€“ Clearoid</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>tailwind.config = { darkMode: 'class' }</script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		body {
			font-family: 'Inter', -apple-system, sans-serif;
		}
	</style>


	<style>
		#response {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 50;
			max-width: 90%;
			width: 500px;
			box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
		}
	
		body:has(#response:not(.hidden))::before {
			content: '';
			position: fixed;
			inset: 0;
			background: rgba(0, 0, 0, 0.4);
			z-index: 40;
		}
	</style>

</head>

<body class="bg-gray-50 dark:bg-black min-h-screen flex items-center justify-center p-6">
	<div class="w-full max-w-2xl">
		<div class="text-center mb-12">
			<h1 class="text-5xl md:text-6xl font-bold text-gray-900 dark:text-white">Upload Excel</h1>
			<p class="mt-4 text-xl text-gray-600 dark:text-gray-400">
				Drop your Excel/CSV file â€” duplicates will be removed automatically
			</p>
		</div>

		<div
			class="bg-white dark:bg-gray-900 rounded-3xl shadow-2xl p-16 border-2 border-dashed border-gray-300 dark:border-gray-700 text-center">
			<div id="dropZone" class="cursor-pointer">
				<svg class="mx-auto h-20 w-20 text-gray-400 mb-6" fill="none" stroke="currentColor" viewBox="0 0 48 48">
					<path
						d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
				</svg>
				<p class="text-2xl font-medium text-gray-700 dark:text-gray-300">Click to select or drag & drop</p>
				<p class="mt-2 text-gray-500">Excel (.xlsx, .xls) or CSV files only</p>
				<input type="file" id="fileInput" accept=".xlsx,.xls,.csv" class="hidden">
			</div>

			<div id="processing" class="hidden mt-10">
				<div class="inline-flex items-center">
					<svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none"
						viewBox="0 0 24 24">
						<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
						<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
					</svg>
					<span class="ml-4 text-xl">Processing your file...</span>
				</div>
			</div>

			<div id="result"
				class="hidden mt-10 p-8 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-2xl">
				<p class="text-2xl font-bold text-green-800 dark:text-green-400" id="resultText"></p>
				<a href="/history.html"
					class="mt-6 inline-block px-10 py-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-2xl shadow-lg transition">
					View Clean List â†’
				</a>
			</div>
		</div>

		<div class="text-center mt-10">
			<a href="/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 hover:underline">â† Back</a>
		</div>
	</div>

	<script>
		const fileInput = document.getElementById('fileInput');
		const dropZone = document.getElementById('dropZone');
		const processing = document.getElementById('processing');
		const result = document.getElementById('result');
		const resultText = document.getElementById('resultText');

		['dragover', 'dragenter'].forEach(evt =>
			dropZone.addEventListener(evt, e => {
				e.preventDefault();
				dropZone.classList.add('border-blue-500');
			})
		);

		['dragleave', 'dragend'].forEach(evt =>
			dropZone.addEventListener(evt, () => dropZone.classList.remove('border-blue-500'))
		);

		dropZone.addEventListener('drop', e => {
			e.preventDefault();
			dropZone.classList.remove('border-blue-500');
			if (e.dataTransfer.files.length) fileInput.files = e.dataTransfer.files;
			uploadFile();
		});

		dropZone.addEventListener('click', () => fileInput.click());
		fileInput.addEventListener('change', uploadFile);

		async function uploadFile() {
			const file = fileInput.files[0];
			if (!file) return;

			processing.classList.remove('hidden');
			result.classList.add('hidden');

			const formData = new FormData();
			formData.append('file', file);

			try {
				const res = await fetch('/excel/bulk-upload', {
					method: 'POST',
					body: formData
				});

				const data = await res.json();

				processing.classList.add('hidden');
				result.classList.remove('hidden');

				resultText.innerHTML = `
					<strong>Upload queued</strong><br>
					File: ${data.filename}<br>
					Job ID: ${data.job_id}<br>
					Processing in background
				`;
			} catch (err) {
				processing.classList.add('hidden');
				result.classList.remove('hidden');
				resultText.innerHTML = 'Upload failed. Check server.';
				result.classList.add('bg-red-50', 'border-red-300');
			}
		}
	</script>

	
</body>

</html>
(venv) C:\Users\Vikram\Downloads\projects\you\Clearoid>(
echo ===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\styles.css =====  
 type C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\styles.css 
) 
===== C:\Users\Vikram\Downloads\projects\you\Clearoid\frontend\styles.css =====
html {
  scroll-behavior: smooth;
}

body {
  font-family: "Inter", system-ui, sans-serif;
}

::selection {
  background: #3b82f6;
  color: white;
}

.dark ::selection {
  background: #60a5fa;
}

/* Cards & panels */
.card,
.panel {
  background: white;
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}

.dark .card,
.dark .panel {
  background: #111827;
  border: 1px solid #1f2937;
}

.card {
  text-align: center;
}

.stat {
  font-size: 2.5rem;
  font-weight: 700;
}

.stat.blue {
  color: #2563eb;
}
.stat.green {
  color: #16a34a;
}
.stat.amber {
  color: #d97706;
}
.stat.purple {
  color: #7c3aed;
}

/* Buttons */
.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 1rem;
  font-weight: 500;
  transition: all 0.25s ease;
}

.btn.primary {
  background: #2563eb;
  color: white;
}

.btn.secondary {
  background: #e5e7eb;
}

.btn:hover {
  transform: translateY(-2px);
}

/* Search */
.search-input {
  padding: 1rem 1.25rem;
  border-radius: 1rem;
  border: 2px solid #d1d5db;
  background: transparent;
  font-size: 1.1rem;
}

.search-input:focus {
  outline: none;
  border-color: #2563eb;
}

/* Table */
.thead th {
  padding: 1.5rem;
  text-align: left;
  font-weight: 600;
  background: #f9fafb;
}

.dark .thead th {
  background: #1f2937;
}

.row td {
  padding: 1.5rem;
  vertical-align: top;
}

.row:hover {
  background: rgba(0, 0, 0, 0.03);
}

.dark .row:hover {
  background: rgba(255, 255, 255, 0.05);
}

/* Badges */
.badge {
  padding: 0.4rem 0.9rem;
  border-radius: 9999px;
  font-size: 0.85rem;
  font-weight: 500;
}

.badge.uniq {
  background: #dcfce7;
  color: #166534;
}

.badge.dup {
  background: #fef3c7;
  color: #92400e;
}

/* Cluster UI */
.cluster-btn {
  font-size: 0.85rem;
  color: #2563eb;
  font-weight: 500;
}

.cluster-btn:hover {
  text-decoration: underline;
}

.cluster-box {
  margin-top: 0.5rem;
  padding: 1rem;
  border-radius: 0.75rem;
  background: #f3f4f6;
}

.dark .cluster-box {
  background: #1f2937;
}

/* States */
.state {
  text-align: center;
  padding: 4rem;
  font-size: 1.25rem;
  color: #6b7280;
}

.muted {
  color: #6b7280;
}

.hidden {
  display: none;
}
